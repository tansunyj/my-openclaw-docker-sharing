version: '3.8'

services:
  openclaw-gateway:
    build: .
    image: openclaw_custom:fixed
    container_name: openclaw-gateway
    restart: unless-stopped
    
    # ❌ 这一行一定要删掉！默认让它用 Root 启动
    # user: "1000:1000"

    working_dir: /app

    environment:
      # 必须指向 /home/node，因为最终我们会切换成 node 用户
      - HOME=/home/node
      - NODE_ENV=production
      - OPENCLAW_GATEWAY_TOKEN=admin123456
      - CLAWDBOT_CONFIG_PATH=/home/node/.openclaw/config.json
      - OPENCLAW_PREFER_PNPM=1

    volumes:
      # 必须映射到 /home/node 下，因为启动脚本修的是这里
      - ./data:/home/node/.openclaw
      - ./workspace:/home/node/clawd
      - ./chrome-data:/home/node/.config/chromium
      - ./install_all.sh:/app/install_all.sh

    ports:
      - "18789:18789"

    deploy:
      resources:
        limits:
          memory: 4G